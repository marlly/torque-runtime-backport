<?xml version="1.0"?>
<!--
 Copyright 2001-2005 The Apache Software Foundation.

 Licensed under the Apache License, Version 2.0 (the "License")
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<document>

 <properties>
 <title>Microsoft SQL Server&#x99; Howto</title>
 <author email="djpolito@apache.org"></author>
</properties>

<body>

<section name="Introductory note">

<p>
This HOWTO was written some time ago and was targeted at the
version of Torque that was coupled with the
<a href="http://jakarta.apache.org/turbine/">Turbine</a> application framework.
Contributions towards updating the information below can be submitted to the
<a href="mailto:torque-dev@db.apache.org">Torque Dev mailing list</a>.
</p>

</section>

<section name="Microsoft SQL Server&#x99; Howto">

<p>
This howto contains configuration help on using MS SQL Server with Turbine.
This Howto supplements the
<a href="http://jakarta.apache.org/turbine/tdk/tdk-howto.html">TDK Howto</a>
page.
</p>

<p>
We appreciate all <a href="http://jakarta.apache.org/site/source.html">patches
and contributions</a> that improve this document.
</p>

</section>

<section name="Create Microsoft SQL Server&#x99; Database">
<p>
Use the SQL Server Enterprise Manager to create the database. When using the TDK,
it helps to name the database the same name as your project. If the name is not
the same, you will need to manually change the database name in your properties
files. After the database is created, you will need to create a new user, or
give an existing user permissions to the new database. Create the new user with
SQL Server Authentication, and assign the users default database to the newly
created database. Make sure the database user has the db_owner role. Please
refer to SQL Server documentation for further details.
</p>

</section>
<section name="JDBC Driver">
<p>
Microsoft has a JDBC driver for MS SQL Server available from their <a
href="http://www.microsoft.com/sql/downloads/">SQL Downloads page</a>.
Alternately, a third party commercial driver from
<a href="http://industry.java.sun.com/products/jdbc/drivers">JDBC(TM)
Technology - Drivers</a>, the JDBC-ODBC bridge driver from Sun, or one of the
free drivers, <a href="http://www.freetds.org">FreeTDS</a> or
<a href="http://jtds.sourceforge.net/">jTDS</a> can be used.
</p>

<p>
The driver from FreeTDS, as of version 0.51, is unstable and buggy, and not
recommended for production environments. Use at your own risk. If you have used
a more recent version of FreeTDS successfully then please let us know.
</p>

<p>
We have only recently been informed of the existence of
<a href="http://jtds.sourceforge.net/">jTDS</a>, which is based on FreeTDS.
Try it out and let us know how it goes.
</p>

<p>
The JDBC-ODBC bridge driver from Sun is included with the Java 2 SDK
Standard Edition as package sun.jdbc.odbc. Sun's statement on this driver is,
&quot;Note that the bridge driver included in the SDK is appropriate only for
experimental use or when no other driver is available.&quot; So use at your own
risk. Also, if you are using a non-windows box to run Turbine, you will need to
find ODBC drivers for SQL server for that platform. For UNIX environments, you
can use <a href="http://www.odbc.org">unixODBC</a>. Please follow the ODBC
driver instructions and setup a DSN for the new database.  You must uncheck the
box that says, "Use ANSI nulls, paddings and warnings.".
</p>

</section>
<section name="Edit property files">
<p>
In the ...\WEB-INF\build\build.properties file make sure that;
</p>

<source><![CDATA[
database=mssql
database.manual.creation = true
]]></source>

<p>
And set the JDBC connection information:
</p>

<source><![CDATA[
databaseDriver = [JDBC Driver]
databaseUser = [db username]
databasePassword = [db password]
databaseHost = [hostname]
databaseUrl = [Follow JDBC Driver Docs]
]]></source>

<p>
If you are using the Microsoft driver
(i.e. <code>com.microsoft.jdbc.sqlserver.SQLServerDriver</code>),
you'll need to use the <code>SelectMethod=cursor</code> parameter in
the JDBC connection string (as outlined by <a
href="http://forum.java.sun.com/thread.jsp?forum=48&amp;thread=184797">this
JDC thread</a>).  Your <code>databaseUrl</code> would look something
like the following:
</p>

<source><![CDATA[
jdbc:microsoft:sqlserver://localhost:1433;DatabaseName=mydb;SelectMethod=cursor
]]></source>

<p>
If you are using the JDBC-ODBC bridge driver:
</p>

<source><![CDATA[
databaseUrl = jdbc:odbc:[DSN Name]
databaseHost = [hostname]
databaseDriver = sun.jdbc.odbc.JdbcOdbcDriver
databaseUser = [db username]
databasePassword = [db password]
]]></source>

<p>
In the ..\WEB-INF\conf\TurbineResources.properties file, set;
</p>

<source><![CDATA[
services.DatabaseService.database.adaptor=DBMSSQL
services.DatabaseService.database.adaptor.DBMSSQL=[JDBC Driver]
]]></source>


</section>

</body>
</document>

